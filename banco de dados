DROP DATABASE IF EXISTS supermercado;
CREATE DATABASE supermercado;
USE supermercado;
CREATE TABLE usuario (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    cpf VARCHAR(14) NOT NULL UNIQUE,
    administrador BOOLEAN NOT NULL
);
CREATE TABLE produto (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    preco DECIMAL(10,2) NOT NULL,
    quantidade INT NOT NULL DEFAULT 0
);
CREATE TABLE compra (
    id INT AUTO_INCREMENT PRIMARY KEY,
    id_usuario INT NOT NULL,
    data_compra TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    total DECIMAL(10,2) NOT NULL DEFAULT 0,

    FOREIGN KEY (id_usuario) REFERENCES usuario(id)
);
CREATE TABLE item_compra (
    id INT AUTO_INCREMENT PRIMARY KEY,
    id_compra INT NOT NULL,
    id_produto INT NOT NULL,

    quantidade INT NOT NULL,
    preco_unitario DECIMAL(10,2) NOT NULL,
    subtotal DECIMAL(10,2) NOT NULL,

    FOREIGN KEY (id_compra) REFERENCES compra(id)
        ON DELETE CASCADE,

    FOREIGN KEY (id_produto) REFERENCES produto(id)
);
INSERT INTO usuario (nome, cpf, administrador)
VALUES ('Administrador', '00000000000', TRUE);
